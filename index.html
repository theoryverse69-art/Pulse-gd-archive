<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PULSE | CLOUD ARCHIVE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;800&display=swap');
        body { background: #000; color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; height: 100vh; }
        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(50px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .page { display: none; height: 100vh; padding: 6rem 2rem 2rem 2rem; }
        .page-active { display: flex; animation: pEnter 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes pEnter { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .staff-only { display: none !important; }
        .is-staff .staff-only { display: flex !important; }

        .player-icon { width: 32px; height: 32px; image-rendering: pixelated; object-fit: contain; background: #111; border-radius: 4px; }
        .lvl-thumb { width: 140px; height: 80px; border-radius: 12px; object-fit: cover; border: 1px solid rgba(255,255,255,0.1); }
        
        .video-wrap { width: 65%; margin: 0 auto 2rem auto; aspect-ratio: 16/9; }
        video { width: 100%; height: 100%; border-radius: 20px; background: #000; }

        .style-tag { background: rgba(0, 255, 255, 0.1); border: 1px solid rgba(0, 255, 255, 0.2); color: #00ffff; padding: 2px 8px; border-radius: 4px; font-size: 9px; font-weight: 800; text-transform: uppercase; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
    </style>
</head>
<body>

    <nav class="fixed top-0 left-0 w-full p-8 flex justify-between items-center z-[150]">
        <div onclick="nav('menu')" class="text-2xl font-black italic tracking-tighter cursor-pointer">PULSE.</div>
        <div class="flex gap-8">
            <span onclick="nav('list')" class="text-[10px] font-bold uppercase cursor-pointer hover:text-cyan-400">Archive</span>
            <span onclick="nav('leaderboard')" class="text-[10px] font-bold uppercase cursor-pointer hover:text-cyan-400">Leaderboard</span>
        </div>
        <div class="flex items-center gap-4">
            <div id="status" class="text-[8px] font-bold opacity-30 uppercase tracking-widest">Cloud Synced</div>
            <button onclick="toggleStaff()" id="staff-indicator" class="w-3 h-3 rounded-full bg-white/10 border border-white/20"></button>
        </div>
    </nav>

    <div id="page-list" class="page gap-6">
        <aside class="w-80 flex flex-col gap-4">
            <div class="glass p-5 rounded-[2rem]">
                <input type="text" id="lvl-search" placeholder="SEARCH..." class="w-full bg-white/5 border border-white/10 p-3 rounded-xl text-[11px] outline-none mb-4" oninput="renderSidebar()">
                <div class="flex justify-between items-center">
                    <span class="text-[10px] font-black opacity-40 uppercase tracking-widest">Entries</span>
                    <button onclick="openAddModal()" class="staff-only w-6 h-6 bg-white text-black rounded-full font-bold">+</button>
                </div>
            </div>
            <div id="sidebar-content" class="flex-1 overflow-y-auto space-y-2"></div>
        </aside>

        <main class="flex-1 glass rounded-[3rem] p-8 flex flex-col overflow-hidden">
            <div id="viewer-empty" class="m-auto opacity-20 font-black italic text-4xl uppercase">Select Entry</div>
            <div id="viewer-content" class="hidden h-full flex flex-col overflow-y-auto pr-4">
                <div class="video-wrap"><video id="v-player" controls></video></div>
                <div class="flex gap-6 items-start">
                    <img id="v-thumb" class="lvl-thumb">
                    <div class="flex-1">
                        <div class="flex items-center gap-4 mb-2">
                            <h2 id="v-title" class="text-5xl font-black italic uppercase tracking-tighter leading-none"></h2>
                            <div id="v-styles" class="flex gap-2"></div>
                        </div>
                        <div class="flex items-center gap-4 mb-4">
                            <img id="v-ver-icon" class="player-icon">
                            <p id="v-ver" class="font-black italic uppercase text-sm"></p>
                            <span class="text-cyan-400 font-black ml-4"><span id="v-pts"></span> PTS</span>
                        </div>
                        <p id="v-desc" class="text-white/50 text-xs leading-relaxed max-w-xl"></p>
                    </div>
                    <div class="w-64 glass p-5 rounded-2xl">
                        <div class="flex justify-between mb-4">
                            <span class="text-[9px] font-black opacity-40 uppercase tracking-widest">Victors</span>
                            <button onclick="addVictorModal()" class="staff-only text-[9px] font-black text-cyan-400 uppercase">+ Add</button>
                        </div>
                        <div id="v-victors" class="space-y-2"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="page-leaderboard" class="page flex-col items-center overflow-y-auto">
        <h2 class="text-5xl font-black italic uppercase mb-12 tracking-tighter">Leaderboard</h2>
        <div id="lb-content" class="w-full max-w-2xl space-y-2"></div>
    </div>

    <div id="level-modal" class="fixed inset-0 bg-black/98 hidden z-[300] flex items-center justify-center p-6">
        <div class="glass p-10 rounded-[3rem] w-full max-w-4xl border-white/20">
            <div class="grid grid-cols-2 gap-8">
                <div class="space-y-4">
                    <input id="in-name" placeholder="Level Name" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none">
                    <input id="in-ver" placeholder="Verifier Name" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none">
                    <input id="in-pts" type="number" placeholder="Points" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none">
                    <input id="in-styles" placeholder="Styles (Flow, Timing)" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none">
                    <textarea id="in-desc" placeholder="Description..." class="w-full bg-white/5 border border-white/10 p-4 rounded-xl h-24 text-xs outline-none"></textarea>
                </div>
                <div class="space-y-4">
                    <p class="text-[9px] font-black opacity-40 uppercase">Files (Limit small sizes)</p>
                    <input type="file" id="in-thumb-file" accept="image/*" class="hidden" onchange="handleFile(this, 'thumb')">
                    <label for="in-thumb-file" class="block bg-white/5 border border-dashed border-white/20 p-3 rounded-xl text-center text-[10px] cursor-pointer">Thumbnail</label>
                    <input type="file" id="in-video-file" accept="video/*" class="hidden" onchange="handleFile(this, 'video')">
                    <label for="in-video-file" class="block bg-white/5 border border-dashed border-white/20 p-3 rounded-xl text-center text-[10px] cursor-pointer">Video</label>
                    <input type="file" id="in-ver-icon" accept="image/*" class="hidden" onchange="handleFile(this, 'ver-icon')">
                    <label for="in-ver-icon" class="block bg-white/5 border border-dashed border-white/20 p-3 rounded-xl text-center text-[10px] cursor-pointer">Verifier Icon</label>
                </div>
            </div>
            <button onclick="saveLevel()" id="save-btn" class="w-full bg-cyan-500 p-4 rounded-2xl mt-8 font-black uppercase text-black italic">Publish to Cloud</button>
            <button onclick="toggleModal('level-modal')" class="w-full mt-2 text-[9px] opacity-30 uppercase">Cancel</button>
        </div>
    </div>

    <div id="victor-modal" class="fixed inset-0 bg-black/98 hidden z-[400] flex items-center justify-center p-6 backdrop-blur-2xl">
        <div class="glass p-10 rounded-[3rem] w-full max-w-sm text-center">
            <h2 class="text-xl font-black uppercase mb-6 italic">Record Victor</h2>
            <input id="vic-name" placeholder="Username" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl mb-4 outline-none">
            <input type="file" id="vic-icon-file" accept="image/*" class="hidden" onchange="handleFile(this, 'vic-icon')">
            <label for="vic-icon-file" class="block bg-white/10 p-4 rounded-xl border border-white/20 text-[10px] mb-8 cursor-pointer font-bold uppercase">Select Player Icon</label>
            <button onclick="confirmVictor()" id="vic-btn" class="w-full bg-cyan-500 text-black p-4 rounded-xl font-black uppercase italic">Publish Record</button>
        </div>
    </div>

    <script>
        // --- !!! YOUR KEYS HERE !!! ---
        const BIN_ID = "698f025043b1c97be97bd479";
        const MASTER_KEY = "$2a$10$aQSkEXzETrsXiBcRD1c88eqNF5v5H9cPk5PhObcbVsvYLJvNTFFsS";
        const STAFF_PASSCODE = "486970"; 

        let db = { levels: [], profiles: {} };
        let activeIdx = null, isStaff = false, tempVideo, tempIcon, tempThumb;

        // --- CLOUD SYNC ---
        async function loadDB() {
            document.getElementById('status').innerText = "Syncing...";
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: { "X-Master-Key": MASTER_KEY }
                });
                const data = await res.json();
                db = data.record;
                renderSidebar();
                document.getElementById('status').innerText = "Cloud Active";
            } catch(e) { document.getElementById('status').innerText = "Offline Mode"; }
        }

        async function syncToCloud() {
            document.getElementById('status').innerText = "Saving...";
            await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: 'PUT',
                headers: { "Content-Type": "application/json", "X-Master-Key": MASTER_KEY },
                body: JSON.stringify(db)
            });
            document.getElementById('status').innerText = "Cloud Active";
        }

        // --- LOGIC ---
        function toggleStaff() {
            if(!isStaff && prompt("STAFF KEY:") === STAFF_PASSCODE) isStaff = true;
            else if(isStaff) isStaff = false;
            document.body.classList.toggle('is-staff', isStaff);
            document.getElementById('staff-indicator').style.background = isStaff ? '#00ffff' : '';
        }

        function handleFile(input, type) {
            const reader = new FileReader();
            reader.onload = (e) => {
                if(type === 'video') tempVideo = e.target.result;
                else if(type === 'ver-icon' || type === 'vic-icon') tempIcon = e.target.result;
                else if(type === 'thumb') tempThumb = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }

        async function saveLevel() {
            document.getElementById('save-btn').innerText = "UPLOADING...";
            const ver = document.getElementById('in-ver').value;
            if(tempIcon) db.profiles[ver] = tempIcon;
            db.levels.push({
                name: document.getElementById('in-name').value,
                ver: ver,
                pts: parseInt(document.getElementById('in-pts').value) || 0,
                desc: document.getElementById('in-desc').value,
                styles: document.getElementById('in-styles').value.split(',').map(s=>s.trim()),
                video: tempVideo,
                thumb: tempThumb,
                victors: []
            });
            await syncToCloud();
            location.reload(); 
        }

        async function confirmVictor() {
            document.getElementById('vic-btn').innerText = "UPLOADING...";
            const name = document.getElementById('vic-name').value;
            if(tempIcon) db.profiles[name] = tempIcon;
            db.levels[activeIdx].victors.push(name);
            await syncToCloud();
            location.reload();
        }

        function showLvl(idx) {
            activeIdx = idx;
            const l = db.levels[idx];
            document.getElementById('viewer-empty').classList.add('hidden');
            document.getElementById('viewer-content').classList.remove('hidden');
            document.getElementById('v-title').innerText = l.name;
            document.getElementById('v-ver').innerText = l.ver;
            document.getElementById('v-pts').innerText = l.pts;
            document.getElementById('v-desc').innerText = l.desc;
            document.getElementById('v-player').src = l.video;
            document.getElementById('v-thumb').src = l.thumb;
            document.getElementById('v-ver-icon').src = db.profiles[l.ver];
            document.getElementById('v-styles').innerHTML = l.styles.map(s => `<span class="style-tag">${s}</span>`).join('');
            renderVictors();
        }

        function renderSidebar() {
            const s = document.getElementById('lvl-search').value.toLowerCase();
            document.getElementById('sidebar-content').innerHTML = db.levels.map((l, i) => {
                if(s && !l.name.toLowerCase().includes(s)) return '';
                return `<div onclick="showLvl(${i})" class="glass p-3 rounded-xl cursor-pointer hover:bg-white/5 transition flex justify-between items-center">
                    <p class="font-black uppercase italic text-[10px]">${l.name}</p>
                    <span class="text-[9px] opacity-40 font-bold">${l.pts}</span>
                </div>`;
            }).join('');
        }

        function renderVictors() {
            document.getElementById('v-victors').innerHTML = db.levels[activeIdx].victors.map(v => `
                <div class="flex items-center gap-3 bg-white/5 p-2 rounded-lg">
                    <img src="${db.profiles[v]}" class="player-icon !w-5 !h-5">
                    <span class="text-[10px] font-bold uppercase">${v}</span>
                </div>
            `).join('');
        }

        function renderLeaderboard() {
            const scores = {};
            db.levels.forEach(l => {
                scores[l.ver] = (scores[l.ver] || 0) + l.pts;
                l.victors.forEach(v => scores[v] = (scores[v] || 0) + l.pts);
            });
            const sorted = Object.entries(scores).sort((a,b) => b[1]-a[1]);
            document.getElementById('lb-content').innerHTML = sorted.map((p, i) => `
                <div class="glass p-4 rounded-2xl flex justify-between items-center">
                    <div class="flex items-center gap-4">
                        <span class="opacity-20 font-black">#${i+1}</span>
                        <img src="${db.profiles[p[0]]}" class="player-icon">
                        <span class="font-black uppercase text-sm">${p[0]}</span>
                    </div>
                    <span class="font-black text-cyan-400">${p[1]} PTS</span>
                </div>
            `).join('');
        }

        function nav(p) { 
            document.querySelectorAll('.page').forEach(pg => pg.classList.remove('page-active'));
            document.getElementById('page-'+p).classList.add('page-active');
            if(p === 'leaderboard') renderLeaderboard();
        }

        function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }
        function openAddModal() { tempVideo = tempIcon = tempThumb = null; toggleModal('level-modal'); }
        function addVictorModal() { tempIcon = null; toggleModal('victor-modal'); }

        loadDB();
        nav('list');
    </script>
</body>
</html>